repos:
  # Custom API key detection (primary defense against secrets)
  - repo: local
    hooks:
      - id: block-api-keys
        name: Block hardcoded API keys  
        entry: bash
        args:
          - -c
          - |
            # Check for common API key patterns, excluding test files
            if find . -name "*.py" -not -path "./test_*" -not -path "./*test*" -not -path "./show_*" -exec grep -l -E "(AIza[0-9A-Za-z_-]{35}|sk-[0-9A-Za-z]{48}|glpat-[0-9A-Za-z_-]{20}|ghp_[0-9A-Za-z]{36})" {} \; 2>/dev/null | head -1 | grep -q .; then
              echo "‚ùå BLOCKED: Hardcoded API keys detected in production code!"
              echo "Use environment variables instead"
              exit 1
            fi
        language: system
        pass_filenames: false
        exclude: ^test_.*\.py$

  # Security scanning with Semgrep
  - repo: https://github.com/semgrep/semgrep
    rev: v1.140.0
    hooks:
      - id: semgrep
        args:
          - '--config=auto'
          - '--error'
          - '--exclude=test_*'
          - '--exclude=__pycache__/'

  # Code formatting
  - repo: https://github.com/psf/black
    rev: '24.10.0'
    hooks:
      - id: black

  # Import sorting
  - repo: https://github.com/PyCQA/isort
    rev: '5.13.2'
    hooks:
      - id: isort
        args: ["--profile", "black"]